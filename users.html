<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý khách hàng - BluePhone Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [CSS CHUNG TỪ DASHBOARD – DÁN LẠI] */
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}
        :root{--primary:#1a73e8;--danger:#d32f2f;--success:#34a853;--warning:#ff6d00;--bg:#f4f6f9}
        body{background:var(--bg);color:#333}
        .header{background:var(--primary);color:#fff;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,.1)}
        .header .logo{font-size:24px;font-weight:bold}
        .header .user{display:flex;align-items:center;gap:10px}
        .user span{font-weight:500}
        .logout-btn{background:var(--danger);color:#fff;border:none;padding:8px 15px;border-radius:6px;cursor:pointer}
        .logout-btn:hover{background:#b71c1c}
        .sidebar{width:260px;background:#2c3e50;color:#fff;position:fixed;top:0;left:0;height:100%;padding-top:70px;overflow-y:auto}
        .sidebar ul{list-style:none}
        .sidebar a{display:block;padding:15px 20px;color:#ecf0f1;text-decoration:none;transition:.3s;border-left:4px solid transparent}
        .sidebar a:hover{background:#34495e;border-left-color:var(--primary)}
        .sidebar i{margin-right:10px;width:18px}
        .main{margin-left:260px;padding:20px;min-height:100vh}
        .page-title{display:flex;align-items:center;gap:10px;font-size:24px;margin-bottom:20px}
        .search-box{display:flex;gap:10px;margin-bottom:20px;max-width:400px}
        .search-box input{flex:1;padding:10px;border:1px solid #ddd;border-radius:4px}
        .search-btn{background:var(--primary);color:#fff;border:none;padding:10px 15px;border-radius:4px;cursor:pointer}
        table{width:100%;border-collapse:collapse;margin-top:20px}
        th,td{padding:12px;text-align:left;border-bottom:1px solid #eee}
        th{background:#f8f9fa;font-weight:600}
        .status-badge{padding:4px 8px;border-radius:4px;font-size:12px}
        .status-active{background:var(--success);color:#fff}
        .status-locked{background:var(--danger);color:#fff}
        .btn-small{padding:4px 8px;border:none;border-radius:4px;cursor:pointer;font-size:12px;margin:0 2px}
        .btn-reset{background:var(--warning);color:#fff}
        .btn-unlock{background:var(--success);color:#fff}
        .btn-lock{background:var(--danger);color:#fff}
        .add-form{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.05);margin-bottom:20px;display:none}
        .add-form.show{display:block}
        .form-group{margin-bottom:15px}
        .form-group label{display:block;margin-bottom:5px;font-weight:500}
        .form-group input{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px}
        @media(max-width:992px){.sidebar{display:none}.main{margin-left:0}}
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">Blue<span style="color:#34a853">Phone</span> Admin</div>
        <div class="user">
            <i class="fas fa-user-circle" style="font-size:24px"></i>
            <span id="adminName">Admin</span>
            <button class="logout-btn" onclick="logout()">Đăng xuất</button>
        </div>
    </div>

    <nav class="sidebar">
        <ul>
            <li><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i>Tổng quan</a></li>
            <li><a href="users.html" class="active"><i class="fas fa-users"></i>Khách hàng</a></li>
            <li><a href="categories.html"><i class="fas fa-tags"></i>Loại SP</a></li>
            <li><a href="products.html"><i class="fas fa-mobile-alt"></i>Sản phẩm</a></li>
            <li><a href="imports.html"><i class="fas fa-truck-loading"></i>Nhập hàng</a></li>
            <li><a href="pricing.html"><i class="fas fa-dollar-sign"></i>Giá bán</a></li>
            <li><a href="orders.html"><i class="fas fa-shopping-cart"></i>Đơn hàng</a></li>
            <li><a href="inventory.html"><i class="fas fa-boxes"></i>Tồn kho</a></li>
        </ul>
    </nav>

    <main class="main">
        <div class="page-title">
            <i class="fas fa-users"></i>
            <h1>Quản lý khách hàng</h1>
        </div>

        <div class="search-box">
            <input type="text" id="userSearch" placeholder="Tìm kiếm theo tên hoặc email...">
            <button class="search-btn" onclick="searchUsers()"><i class="fas fa-search"></i></button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Tên đăng nhập</th>
                    <th>Email</th>
                    <th>Ngày đăng ký</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody id="userList">
                <tr><td colspan="5">Đang tải...</td></tr>
            </tbody>
        </table>
    </main>

    <script src="../assets/js/admin.js"></script>
    <script>
        checkAdminLogin();
        document.getElementById('adminName').textContent = JSON.parse(localStorage.getItem('currentAdmin')).username;

        // Render danh sách khách hàng
        function renderUsers(users = getData('users')) {
            const tbody = document.getElementById('userList');
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:40px">Chưa có khách hàng nào</td></tr>';
                return;
            }
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.username}</td>
                    <td>${user.email || 'N/A'}</td>
                    <td>${new Date(user.createdAt).toLocaleDateString('vi-VN')}</td>
                    <td><span class="status-badge status-${user.status || 'active'}">${user.status === 'locked' ? 'Khóa' : 'Hoạt động'}</span></td>
                    <td>
                        <button class="btn-small btn-reset" onclick="resetPassword('${user.username}')">Reset MK</button>
                        <button class="btn-small ${user.status === 'locked' ? 'btn-unlock' : 'btn-lock'}" onclick="toggleUserStatus('${user.username}')">
                            ${user.status === 'locked' ? 'Mở khóa' : 'Khóa'}
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Reset mật khẩu
        window.resetPassword = (username) => {
            if (confirm(`Reset mật khẩu cho ${username}? Mật khẩu mới sẽ là 123456`)) {
                let users = getData('users');
                const user = users.find(u => u.username === username);
                if (user) {
                    user.password = '123456';
                    saveData('users', users);
                    alert('Đã reset mật khẩu thành công! Mật khẩu mới: 123456');
                    renderUsers();
                }
            }
        };

        // Khóa/Mở khóa tài khoản
        window.toggleUserStatus = (username) => {
            let users = getData('users');
            const user = users.find(u => u.username === username);
            if (user) {
                user.status = user.status === 'locked' ? 'active' : 'locked';
                saveData('users', users);
                alert(user.status === 'active' ? 'Đã mở khóa tài khoản' : 'Đã khóa tài khoản');
                renderUsers();
            }
        };

        // Tìm kiếm
        window.searchUsers = () => {
            const query = document.getElementById('userSearch').value.toLowerCase();
            const allUsers = getData('users');
            const filtered = allUsers.filter(u => 
                u.username.toLowerCase().includes(query) || 
                (u.email && u.email.toLowerCase().includes(query))
            );
            renderUsers(filtered);
        };

        // Load ban đầu
        renderUsers();
        document.getElementById('userSearch').addEventListener('keyup', searchUsers);
    </script>
</body>
</html>