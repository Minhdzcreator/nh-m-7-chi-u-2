<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard - BluePhone</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}
    :root{--primary:#1a73e8;--danger:#d32f2f;--success:#34a853;--warning:#ff6d00}
    body{background:#f4f6f9;color:#333}
    .header{background:var(--primary);color:#fff;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,.1)}
    .header .logo{font-size:24px;font-weight:bold}
    .header .user{display:flex;align-items:center;gap:10px}
    .sidebar{width:260px;background:#2c3e50;color:#fff;position:fixed;top:0;left:0;height:100%;padding-top:80px;overflow-y:auto}
    .sidebar ul{list-style:none}
    .sidebar a{display:block;padding:15px 20px;color:#ecf0f1;text-decoration:none;transition:.3s;border-left:4px solid transparent}
    .sidebar a:hover,.sidebar a.active{background:#34495e;border-left-color:var(--primary)}
    .sidebar i{margin-right:10px}
    .main{margin-left:260px;padding:20px}
    .card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px;margin-bottom:30px}
    .card{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.05);text-align:center}
    .card h3{font-size:14px;color:#666;margin-bottom:10px}
    .card .value{font-size:28px;font-weight:bold;color:var(--primary)}
    .logout-btn{background:var(--danger);color:#fff;border:none;padding:8px 15px;border-radius:6px;cursor:pointer}
    @media(max-width:992px){.sidebar{position:relative;width:100%;height:auto;padding-top:0}.main{margin-left:0}}
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">Blue<span style="color:#34a853">Phone</span> Admin</div>
    <div class="user">
      <span id="adminName">Admin</span>
      <button class="logout-btn" onclick="logout()">Đăng xuất</button>
    </div>
  </div>

  <div class="sidebar">
    <ul>
      <li><a href="dashboard.html" class="active"><i class="fas fa-tachometer-alt"></i> Tổng quan</a></li>
      <li><a href="users.html"><i class="fas fa-users"></i> Quản lý khách hàng</a></li>
      <li><a href="categories.html"><i class="fas fa-tags"></i> Loại sản phẩm</a></li>
      <li><a href="products.html"><i class="fas fa-mobile-alt"></i> Sản phẩm</a></li>
      <li><a href="imports.html"><i class="fas fa-truck-loading"></i> Nhập hàng</a></li>
      <li><a href="pricing.html"><i class="fas fa-dollar-sign"></i> Giá bán</a></li>
      <li><a href="orders.html"><i class="fas fa-shopping-cart"></i> Đơn hàng</a></li>
      <li><a href="inventory.html"><i class="fas fa-boxes"></i> Tồn kho</a></li>
    </ul>
  </div>

  <div class="main">
    <h2>Tổng quan hệ thống</h2>
    <div class="card-grid">
      <div class="card"><h3>Tổng khách hàng</h3><div class="value" id="totalUsers">0</div></div>
      <div class="card"><h3>Sản phẩm</h3><div class="value" id="totalProducts">0</div></div>
      <div class="card"><h3>Đơn hàng hôm nay</h3><div class="value" id="todayOrders">0</div></div>
      <div class="card"><h3>Tồn kho thấp</h3><div class="value" id="lowStock">0</div></div>
    </div>
  </div>

  <script src="../assets/js/admin.js"></script>
  <script>
    checkAdminLogin();
    document.getElementById('adminName').textContent = JSON.parse(localStorage.getItem('currentAdmin')).username;

    // Load dashboard stats
    const users = getData('users');
    const products = getData('products');
    const orders = getData('orders');

    $('totalUsers').textContent = users.length;
    $('totalProducts').textContent = products.filter(p => !p.hidden).length;

    const today = new Date().toISOString().split('T')[0];
    const todayOrders = orders.filter(o => o.date.startsWith(today)).length;
    $('todayOrders').textContent = todayOrders;

    // Tồn kho thấp
    const stock = {};
    products.forEach(p => stock[p.id] = 0);
    getData('imports').forEach(imp => {
      if (imp.status === 'completed') {
        imp.items.forEach(item => stock[item.productId] += item.quantity);
      }
    });
    orders.forEach(order => {
      if (['processed', 'delivered'].includes(order.status)) {
        order.items.forEach(item => stock[item.productId] -= item.quantity);
      }
    });
    const lowStock = Object.values(stock).filter(q => q < 5).length;
    $('lowStock').textContent = lowStock;
  </script>
</body>
</html>