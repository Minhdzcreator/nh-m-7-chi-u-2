<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý loại sản phẩm - BluePhone Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [CSS CHUNG TỪ DASHBOARD] */
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}
        :root{--primary:#1a73e8;--danger:#d32f2f;--success:#34a853;--warning:#ff6d00;--bg:#f4f6f9}
        body{background:var(--bg);color:#333}
        .header{background:var(--primary);color:#fff;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,.1)}
        .header .logo{font-size:24px;font-weight:bold}
        .header .user{display:flex;align-items:center;gap:10px}
        .user span{font-weight:500}
        .logout-btn{background:var(--danger);color:#fff;border:none;padding:8px 15px;border-radius:6px;cursor:pointer}
        .logout-btn:hover{background:#b71c1c}
        .sidebar{width:260px;background:#2c3e50;color:#fff;position:fixed;top:0;left:0;height:100%;padding-top:70px;overflow-y:auto}
        .sidebar ul{list-style:none}
        .sidebar a{display:block;padding:15px 20px;color:#ecf0f1;text-decoration:none;transition:.3s;border-left:4px solid transparent}
        .sidebar a:hover{background:#34495e;border-left-color:var(--primary)}
        .sidebar i{margin-right:10px;width:18px}
        .main{margin-left:260px;padding:20px;min-height:100vh}
        .page-title{display:flex;align-items:center;gap:10px;font-size:24px;margin-bottom:20px}
        .add-section{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.05);margin-bottom:20px}
        .add-form{display:flex;gap:15px;align-items:center;flex-wrap:wrap}
        .form-group{flex:1;min-width:200px}
        .form-group label{display:block;margin-bottom:5px;font-weight:500}
        .form-group input{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px}
        .add-btn{background:var(--primary);color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-weight:500}
        .add-btn:hover{background:#0d47a1}
        table{width:100%;border-collapse:collapse;margin-top:20px}
        th,td{padding:12px;text-align:left;border-bottom:1px solid #eee}
        th{background:#f8f9fa;font-weight:600}
        .status-badge{padding:4px 8px;border-radius:4px;font-size:12px}
        .status-visible{background:var(--success);color:#fff}
        .status-hidden{background:var(--danger);color:#fff}
        .btn-small{padding:4px 8px;border:none;border-radius:4px;cursor:pointer;font-size:12px;margin:0 2px}
        .btn-edit{background:var(--primary);color:#fff}
        .btn-toggle{background:var(--warning);color:#fff}
        .btn-delete{background:var(--danger);color:#fff}
        @media(max-width:992px){.sidebar{display:none}.main{margin-left:0}.add-form{flex-direction:column}}
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">Blue<span style="color:#34a853">Phone</span> Admin</div>
        <div class="user">
            <i class="fas fa-user-circle" style="font-size:24px"></i>
            <span id="adminName">Admin</span>
            <button class="logout-btn" onclick="logout()">Đăng xuất</button>
        </div>
    </div>

    <nav class="sidebar">
        <ul>
            <li><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i>Tổng quan</a></li>
            <li><a href="users.html"><i class="fas fa-users"></i>Khách hàng</a></li>
            <li><a href="categories.html" class="active"><i class="fas fa-tags"></i>Loại SP</a></li>
            <li><a href="products.html"><i class="fas fa-mobile-alt"></i>Sản phẩm</a></li>
            <li><a href="imports.html"><i class="fas fa-truck-loading"></i>Nhập hàng</a></li>
            <li><a href="pricing.html"><i class="fas fa-dollar-sign"></i>Giá bán</a></li>
            <li><a href="orders.html"><i class="fas fa-shopping-cart"></i>Đơn hàng</a></li>
            <li><a href="inventory.html"><i class="fas fa-boxes"></i>Tồn kho</a></li>
        </ul>
    </nav>

    <main class="main">
        <div class="page-title">
            <i class="fas fa-tags"></i>
            <h1>Quản lý loại sản phẩm</h1>
        </div>

        <div class="add-section">
            <h3>Thêm loại mới</h3>
            <form id="addCategoryForm" class="add-form">
                <div class="form-group">
                    <label>Tên loại sản phẩm</label>
                    <input type="text" id="categoryName" placeholder="Ví dụ: Điện thoại iPhone" required>
                </div>
                <button type="submit" class="add-btn">Thêm loại</button>
            </form>
        </div>

        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tên loại</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody id="categoryList">
                <tr><td colspan="4">Đang tải...</td></tr>
            </tbody>
        </table>
    </main>

    <script src="../assets/js/admin.js"></script>
    <script>
        checkAdminLogin();
        document.getElementById('adminName').textContent = JSON.parse(localStorage.getItem('currentAdmin')).username;

        // Render danh sách loại
        function renderCategories() {
            const categories = getData('categories');
            const tbody = document.getElementById('categoryList');
            if (categories.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:40px">Chưa có loại sản phẩm nào</td></tr>';
                return;
            }
            tbody.innerHTML = categories.map(cat => `
                <tr>
                    <td>${cat.id}</td>
                    <td>${cat.name}</td>
                    <td><span class="status-badge status-${cat.hidden ? 'hidden' : 'visible'}">${cat.hidden ? 'Ẩn' : 'Hiển thị'}</span></td>
                    <td>
                        <button class="btn-small btn-edit" onclick="editCategory('${cat.id}')">Sửa</button>
                        <button class="btn-small btn-toggle" onclick="toggleCategory('${cat.id}')">${cat.hidden ? 'Hiện' : 'Ẩn'}</button>
                        <button class="btn-small btn-delete" onclick="deleteCategory('${cat.id}')">Xóa</button>
                    </td>
                </tr>
            `).join('');
        }

        // Thêm loại
        document.getElementById('addCategoryForm').addEventListener('submit', e => {
            e.preventDefault();
            const name = document.getElementById('categoryName').value.trim();
            if (name) {
                const categories = getData('categories');
                const newCat = {
                    id: Date.now().toString(),
                    name: name,
                    hidden: false,
                    createdAt: new Date().toISOString()
                };
                categories.push(newCat);
                saveData('categories', categories);
                document.getElementById('categoryName').value = '';
                alert('Thêm loại thành công!');
                renderCategories();
            }
        });

        // Sửa loại
        window.editCategory = (id) => {
            const categories = getData('categories');
            const cat = categories.find(c => c.id === id);
            const newName = prompt('Tên loại mới:', cat.name);
            if (newName && newName.trim()) {
                cat.name = newName.trim();
                saveData('categories', categories);
                alert('Cập nhật thành công!');
                renderCategories();
            }
        };

        // Ẩn/Hiện loại
        window.toggleCategory = (id) => {
            const categories = getData('categories');
            const cat = categories.find(c => c.id === id);
            cat.hidden = !cat.hidden;
            saveData('categories', categories);
            alert(cat.hidden ? 'Đã ẩn loại' : 'Đã hiện loại');
            renderCategories();
        };

        // Xóa loại
        window.deleteCategory = (id) => {
            if (confirm('Xóa loại này? (Không thể khôi phục)')) {
                let categories = getData('categories');
                categories = categories.filter(c => c.id !== id);
                saveData('categories', categories);
                alert('Xóa thành công!');
                renderCategories();
            }
        };

        // Load ban đầu
        renderCategories();
    </script>
</body>
</html>